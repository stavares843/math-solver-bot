name: Add CI label

on:
  pull_request_target:
    types: [created]

permissions:
  issues: write
  pull-requests: write

jobs:
  solve:
    runs-on: ubuntu-latest

    steps:
      - name: Add CI label
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: |
          COMMENT_BODY=$(jq -r '.comment.body' "$GITHUB_EVENT_PATH")
          ISSUE_NUMBER=$(jq -r '.pull_request.number' "$GITHUB_EVENT_PATH")

          if [[ "$COMMENT_BODY" =~ ^/ci ]]; then
            curl -f -H "Authorization: Bearer $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github+json" \
              -X POST \
              "https://api.github.com/repos/$GITHUB_REPOSITORY/issues/$ISSUE_NUMBER/labels" \
              -d '{"labels":["ci"]}'
          fi
